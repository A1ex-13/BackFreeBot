# BackFreeBot - –±–æ—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

![@BackFree_Bot](https://github.com/A1ex-13/BackFreeBot/blob/main/photo_2024-09-21_10-14-38.jpg)  
üîó [@BackFree_Bot](https://t.me/BackFree_Bot)

**"–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è: –æ—Ç –∏–¥–µ–∏ –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è"**

–≠—Ç–∞ —Ä–∞–±–æ—Ç–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –Ω–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ—é –º–æ–¥–µ–ª—å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è. 
–ü–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—É –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å: –æ—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∏–¥–µ–∏ –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö. 
–í—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞—Ç—å –∏ –æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å, –∞ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤ –±—É–¥—É—â–µ–º –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. 
–ù–∞–∑–æ–≤–µ–º —ç—Ç–æ –∫—É—Ä—Å–æ–º –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Å–≤–æ–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.

–ü—Ä–æ–ø—É—Å—Ç–∏–º –ø—Ä–æ—Ü–µ—Å—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –≤–∞—à–µ–≥–æ  –∂–µ–ª–µ–∑–∞ ‚Äî —ç—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–¥–µ–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è. 
–í–∞–º —Å—Ç–æ–∏—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–¥ –∏ –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å.



–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è. –ï—Å—Ç—å –¥–≤–µ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ :

**1 –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞:** –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ *IDE*, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ *PyCharm* –∏–ª–∏ *VS Code*. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –º–æ—â–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ.

**2 –û–±–ª–∞—á–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:** –¢–∞–∫–∏–µ –∫–∞–∫ *```Google Colab```, Kaggle Notebooks, Jupyter Notebooks* –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö AWS –∏–ª–∏ Azure. –≠—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –º–æ—â–Ω—ã–º GPU –∏ –±–æ–ª—å—à–æ–º—É –æ–±—ä–µ–º—É –ø–∞–º—è—Ç–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –æ—Ç–ª–∏—á–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –¥–ª—è –º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

–û–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–¥–∞ —è –ø–µ—Ä–µ–¥–∞–º –≤ ```–æ–±–ª–∞–∫–æ```, —á—Ç–æ –∏ –≤–∞–º —Å–æ–≤–µ—Ç—É—é:

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - –≠—Ç–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª–∞–º–∏. 

–ú–æ–π –ø—Ä–∏–º–µ—Ä - –æ—Å–Ω–∞–≤–Ω–∞—è –ø–∞–ø–∫–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞ **BackFreeBot_CV**

## BackFreeBot_CV/

‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Photo/** # –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±—ã—á–Ω—ã–µ —Ñ–æ—Ç–æ —Å–¥–µ–ª–∞–Ω—ã–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω  
    ‚îî‚îÄ‚îÄ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞ —Å –∏–º–µ–Ω–µ–º 100001_27.09.2024_22.05.jpg
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Mask_Canny/** # –ú–∞—Å–∫–∏ Canny - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏  
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤ mask_canny_new_100001_27.09.2024_22.05.png  
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Mask_Grab/** # –ú–∞—Å–∫–∏ Grab - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏  
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤ mask_grab_100001_27.09.2024_22.05.png
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Mask_Grab_Mirroredy/** # –ó–µ—Ä–∫–∞–ª—å–Ω—ã–µ –º–∞—Å–∫–∏ Grab - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏  
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤ mask_grab_mirrored_100001_27.09.2024_22.05.png  
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Mask_DeepLabV3/** # –ú–∞—Å–∫–∏ DeepLabV3 - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏   
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤ 100004_27.09.2024_22.05_deeplabv3.png  
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Mask_Combined/** # –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å–∫–∏ - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è    
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤.jpg –∏–ª–∏ .png   
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Resolt/** # –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏     
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤.jpg –∏–ª–∏ .png    
    
‚îú‚îÄ‚îÄ **BackFreeBot_folderId_Finish/** # —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
    ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤.jpg –∏–ª–∏ .png  
    
‚îú‚îÄ‚îÄ **user_id_timestamp.ipynb**- notebooks/  # Jupyter –Ω–æ—É—Ç–±—É–∫ —Å –∫–æ–¥–æ–º  

‚îú‚îÄ‚îÄ **unet_model.pth** - models/ # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å  

‚îú‚îÄ‚îÄ **deeplabv3_resnet101.pth** - models/ # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è DeepLabV3

‚îú‚îÄ‚îÄ **README.md**  # —Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–µ–º, –∏ –≤—ã —ç—Ç–æ —á–∏—Ç–∞–µ—Ç–µ.

‚îú‚îÄ‚îÄ **model_training_counter.txt**  - —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—É—Å–∫–æ–≤ (—è —Å–¥–µ–ª–∞–ª –∫–∞–∂–¥—ã–µ 10 —Ä–∞–∑) –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–∏–ª–∏ deeplabv3_resnet101

‚îî‚îÄ‚îÄ **photo_2024-09-21_10-14-38.jpg** # 

# –®–ê–ì 1 üíªüõ†Ô∏è 

üîÑüìÇ –£–ø—Ä–æ—â–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –ø–æ–º–æ—â—å—é —Å–ª–æ–≤–∞—Ä—è –∏ —Ü–∏–∫–ª–∞  

üéØüí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è : –¢–µ–ø–µ—Ä—å –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∏—Ö –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ–∑–¥–∞–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.  

üîÅüßπ –¶–∏–∫–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ : –ú—ã –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º —Å –ø–æ–º–æ—â—å—é —Ü–∏–∫–ª–∞ ```for```, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏ –¥–µ–ª–∞—è –µ–≥–æ —á–∏—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ.  

üìÇ‚úÖ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–¥ –Ω–∞ Python –∏ –≤—ã —Å—Ä–∞–∑—É —É–≤–∏–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞–ø–æ–∫, –∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

```python
import os

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
directories = {
    "image_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Photo',
    "mask_grab_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Grab',
    "mask_grab_mirrored_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Grab_Mirrored',
    "mask_canny_dir": '//BackFreeBot_CV/BackFreeBot_folderId_Mask_Canny',
    "mask_deeplabv3_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Mask_DeepLabV3',
    "mask_combined_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Combined',
    "image_resolt_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Resolt',
    "finish_dir": '/BackFreeBot_CV/BackFreeBot_folderId_Finish'
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for dir_name, dir_path in directories.items():
    if os.path.exists(dir_path):
        print(f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è {dir_name} ({dir_path}) —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:")
        print(os.listdir(dir_path))
    else:
        print(f"–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è {dir_name} ({dir_path}) –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.")
        os.makedirs(dir_path)
```
# –®–ê–ì 2  BackFreeBot_folderId_Mask_Grab & BackFreeBot_folderId_Mask_Grab_Mirrore
üîç‚ú® –ú–æ–¥–µ–ª—å GrabCut: –ú–∞–≥–∏—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 

GrabCut ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–¥–µ–ª—è—Ç—å –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω –æ—Ç —Ñ–æ–Ω–∞ –Ω–∞ —Ñ–æ—Ç–æ. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥—ã –≥—Ä–∞—Ñ–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.  

üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?  

üìå –ó–∞–¥–∞–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –æ–±—ä–µ–∫—Ç.  
üîó –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ, –≥–¥–µ –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å ‚Äî —ç—Ç–æ —É–∑–µ–ª.  
‚úÇÔ∏è –ò—Å–ø–æ–ª—å–∑—É—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑—Ä–µ–∑ –≥—Ä–∞—Ñ–∞, –æ—Ç–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω –æ—Ç —Ñ–æ–Ω–∞.  

üîπ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?  

üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.  
üé® –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–æ–∫ –¥–ª—è —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.  
üõ†Ô∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–º –∑—Ä–µ–Ω–∏–∏.  

```python  
import os
import cv2
import numpy as np

# –£–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–∞–º 
image_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Photo'
mask_grab_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Grab'
mask_grab_mirrored_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Grab_Mirrored'

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Å–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ GrabCut
def generate_mask_grabcut(image_path, save_path):
    img = cv2.imread(image_path)
    if img is None:
        print(f"–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {image_path}. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª.")
        return
    mask = np.zeros(img.shape[:2], np.uint8)
    bgdModel = np.zeros((1, 65), np.float64)
    fgdModel = np.zeros((1, 65), np.float64)

    rect = (10, 10, img.shape[1] - 10, img.shape[0] - 10)  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
    cv2.grabCut(img, mask, rect, bgdModel, fgdModel, 5, cv2.GC_INIT_WITH_RECT)

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞—Å–∫—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–µ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    mask2 = np.where((mask == 2) | (mask == 0), 0, 1).astype('uint8')
    masked_img = img * mask2[:, :, np.newaxis]
    cv2.imwrite(save_path, masked_img)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Å–∫–∏ –Ω–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
def generate_mask_grabcut_mirrored(image_path, save_path_mirrored):
    img = cv2.imread(image_path)
    if img is None:
        print(f"–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {image_path}. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª.")
        return

    mirrored_img = cv2.flip(img, 1)  # –ó–µ—Ä–∫–∞–ª–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
    mask = np.zeros(mirrored_img.shape[:2], np.uint8)
    bgdModel = np.zeros((1, 65), np.float64)
    fgdModel = np.zeros((1, 65), np.float64)

    rect = (10, 10, mirrored_img.shape[1] - 10, mirrored_img.shape[0] - 10)  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
    cv2.grabCut(mirrored_img, mask, rect, bgdModel, fgdModel, 5, cv2.GC_INIT_WITH_RECT)

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞—Å–∫—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–µ –∫ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    mask2 = np.where((mask == 2) | (mask == 0), 0, 1).astype('uint8')
    masked_mirrored_img = mirrored_img * mask2[:, :, np.newaxis]
    cv2.imwrite(save_path_mirrored, masked_mirrored_img)

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∑–µ—Ä–∫–∞–ª—å–Ω—ã—Ö –º–∞—Å–æ–∫, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if not os.path.exists(mask_grab_mirrored_dir):
    os.makedirs(mask_grab_mirrored_dir)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–ø–∫–µ
for image_file in os.listdir(image_dir):
    image_path = os.path.join(image_dir, image_file)

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å–∫–∏ –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    mask_path = os.path.join(mask_grab_dir, f'mask_grab_{os.path.splitext(image_file)[0]}.png')
    try:
        generate_mask_grabcut(image_path, mask_path)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ {image_file}: {e}")

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å–∫–∏ –¥–ª—è –∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    mask_mirrored_path = os.path.join(mask_grab_mirrored_dir, f'mask_grab_mirrored_{os.path.splitext(image_file)[0]}.png')
    try:
        generate_mask_grabcut_mirrored(image_path, mask_mirrored_path)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ {image_file}: {e}")

print("–ú–∞—Å–∫–∏ Grab –∏ –∑–µ—Ä–∫–∞–ª—å–Ω—ã–µ –º–∞—Å–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.")
```
# –®–ê–ì 3 BackFreeBot_folderId_Mask_Canny

üéØüîç –ú–æ–¥–µ–ª—å Canny: –ò–¥–µ–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö   

–ê–ª–≥–æ—Ä–∏—Ç–º Canny ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç—É—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è —à—É–º –∏ —É–ª—É—á—à–∞—è —á–µ—Ç–∫–æ—Å—Ç—å –≥—Ä–∞–Ω–∏—Ü.  

üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?  

üßΩ –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ: –†–∞–∑–º—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏.  
üö¶ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü.  
‚úÇÔ∏è –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–º–∞–∫—Å–∏–º—É–º–æ–≤: –£–±–∏—Ä–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã.  
‚úÖ –î–≤–æ–π–Ω–æ–π –ø–æ—Ä–æ–≥: –†–∞–∑–¥–µ–ª—è–µ—Ç —Å–ª–∞–±—ã–µ –∏ —Å–∏–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.  

üîπ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?  

üèûÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–Ω—ã—Ö –∫–∞—Ä—Ç.    
üîç –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.  
ü§ñ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–µ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–º –∑—Ä–µ–Ω–∏–∏.  

```python
import os
import cv2
import numpy as np

# –£–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –Ω–∞ Google –î–∏—Å–∫–µ
image_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Photo'
mask_canny_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Mask_Canny'

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞ –ö—ç–Ω–Ω–∏ –∏ –∫–æ–Ω—Ç—É—Ä–æ–≤
def remove_background_canny(image_path, save_path):
    img = cv2.imread(image_path)
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ö—ç–Ω–Ω–∏ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü
    edges = cv2.Canny(gray, 100, 200)

    # –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç—É—Ä–æ–≤
    contours, _ = cv2.findContours(edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

    # –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏ (–∑–∞–ª–∏—Ç–∞—è –æ–±–ª–∞—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—É—Ä–æ–≤)
    mask = np.zeros_like(img)

    # –ó–∞–ª–∏–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—É—Ä–æ–≤
    cv2.drawContours(mask, contours, -1, (255, 255, 255), thickness=cv2.FILLED)

    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–æ–≤)
    kernel = np.ones((5, 5), np.uint8)
    mask = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)

    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å–∫–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞)
    result = cv2.bitwise_and(img, mask)

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    cv2.imwrite(save_path, result)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–ø–∫–µ
for image_file in os.listdir(image_dir):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .jpg
    if image_file.endswith('.jpg'):
        image_path = os.path.join(image_dir, image_file)
        mask_path = os.path.join(mask_canny_dir, 'mask_canny_new_' + os.path.splitext(image_file)[0] + '.png')  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ .png

        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        remove_background_canny(image_path, mask_path)

print("–ú–∞—Å–∫–∏ canny —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.")
```
# –®–ê–ì 4 ü§ñüñ•Ô∏è BackFreeBot_folderId_Mask_DeepLabV3  
## –®–ê–ì 4.1  –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å–∫–∏ DeepLabV3  
üñºÔ∏èüîç DeepLabV3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–∞—Å—Ç–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π   

DeepLabV3 ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–∏–∫—Å–µ–ª–µ–π. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–¥–µ–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é, —Ä–∞–∑–¥–µ–ª—è—è –µ–≥–æ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã.  [–°–∫–∞—á–∞—Ç—å deeplabv3_resnet101.pth](https://download.pytorch.org/models/deeplabv3_resnet101_coco-586e8e8f.pth)  

üîπ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?  

üß† –ì–ª—É–±–æ–∫–∞—è —Å–≤–µ—Ä—Ç–æ—á–Ω–∞—è —Å–µ—Ç—å: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.  
üîó –ê—Ç—Ä–æ–ø–Ω–æ–µ —Å–≤–µ—Ä—Ç–∫–∏: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Ä–∞–∑–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤—ã—Å–æ–∫—É—é –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é.  
üó∫Ô∏è –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ü–µ–Ω—ã: –†–∞–∑–±–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—è –¥–∞–∂–µ –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏.  

üîπ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?  

üõ£Ô∏è –†–∞–∑–º–µ—Ç–∫–∞ –¥–æ—Ä–æ–≥ –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –≤–æ–∂–¥–µ–Ω–∏—è.  
üè° –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–¥–∞–Ω–∏–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–∞—Ö.  
üå≥ –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö.  
üöÄDeepLabV3 ‚Äî –≤–∞—à –≤—ã–±–æ—Ä –¥–ª—è –∑–∞–¥–∞—á, –≥–¥–µ –≤–∞–∂–Ω–∞ –∫–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å! 

ü§ñüñ•Ô∏è –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É

    ‚îú‚îÄ‚îÄ BackFreeBot_folderId_Mask_DeepLabV3/ # –ú–∞—Å–∫–∏ DeepLabV3 - –ø–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–∫–∏   
        ‚îî‚îÄ‚îÄ –∏–º—è —Ñ–∞–π–ª–æ–≤ 100004_27.09.2024_22.05_deeplabv3.png     
    ‚îú‚îÄ‚îÄ deeplabv3_resnet101.pth - –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å DeepLabV3 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ResNet-101.  
    ‚îú‚îÄ‚îÄ model_training_counter.txt  - —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—É—Å–∫–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–∞–ª –∫–∞–∂–¥—ã–µ 10 —Ä–∞–∑) –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–∏–ª–∏ deeplabv3_resnet101    
    ‚îî‚îÄ‚îÄ pytorch/vision:v0.10.0 ‚Äî —ç—Ç–æ –≤–µ—Ä—Å–∏—è Docker-–æ–±—Ä–∞–∑–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è PyTorch –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É torchvision –≤–µ—Ä—Å–∏–∏ 0.10.0. –≠—Ç–æ—Ç –æ–±—Ä–∞–∑ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π—Ä–æ–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.    

üîπ –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ—Ç –æ–±—Ä–∞–∑ –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ [–°–∫–∞—á–∞—Ç—å Docker-–æ–±—Ä–∞–∑ pytorch/vision:v0.10.0](https://hub.docker.com/r/pytorch/vision/tags?page=1&name=v0.10.0)  

üîß PyTorch: –í–µ—Ä—Å–∏—è 1.9.0, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π.  
üì∑ torchvision: –í–µ—Ä—Å–∏—è 0.10.0, –≤–∫–ª—é—á–∞–µ—Ç –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.  
üõ†Ô∏è CUDA (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è): –û–±—Ä–∞–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å GPU, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π.  

üîπ –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?  

üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ PyTorch.  
üñºÔ∏è –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.  
ü§ñ –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö.  
üåü –≠—Ç–æ—Ç Docker-–æ–±—Ä–∞–∑ —É–¥–æ–±–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö.  

```python
import torch
import torchvision.transforms as T
from PIL import Image
import numpy as np
import os

# –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
model_save_path = '/BackFreeBot_CV/deeplabv3_resnet101.pth'
# –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∑–∞–ø—É—Å–∫–æ–≤
counter_path = '/BackFreeBot_CV/model_training_counter.txt'

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª —Å—á–µ—Ç—á–∏–∫–∞ –∏ —á–∏—Ç–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, –∏–Ω–∞—á–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ 0
if os.path.exists(counter_path):
    with open(counter_path, 'r') as f:
        try:
            training_counter = int(f.read().strip())
        except ValueError:
            training_counter = 0
else:
    training_counter = 0

# –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏, –µ—Å–ª–∏ True —Ç–æ –±—É–¥–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑ –æ–±—É—á–∞—Ç—å—Å—è
should_train_model = False

# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ —Ñ–∞–π–ª
training_counter += 1
with open(counter_path, 'w') as f:
    f.write(str(training_counter))

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±—É—á–∞—Ç—å –º–æ–¥–µ–ª—å (–∫–∞–∂–¥—ã–π 10-–π –∑–∞–ø—É—Å–∫)
if training_counter >= 10:
    should_train_model = True
    training_counter = 0  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è
    with open(counter_path, 'w') as f:
        f.write(str(training_counter))  # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ —Ñ–∞–π–ª–µ

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º strict=False
def load_model(model_path, device):
    model = torch.hub.load('pytorch/vision:v0.10.0', 'deeplabv3_resnet101', pretrained=False)  # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –±–µ–∑ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤
    state_dict = torch.load(model_path, map_location=device)
    model.load_state_dict(state_dict, strict=False)  # strict=False –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∫–ª—é—á–∏
    model.to(device)
    model.eval()
    return model

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')

if should_train_model:
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ DeepLabV3 –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    model = torch.hub.load('pytorch/vision:v0.10.0', 'deeplabv3_resnet101', pretrained=True)
    model.to(device)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞ Google –î–∏—Å–∫–µ
    torch.save(model.state_dict(), model_save_path)
    print(f"–ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±—É—á–µ–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ {model_save_path}")
else:
    # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    model = load_model(model_save_path, device)
    print("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.")

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–µ–Ω–∑–æ—Ä –¥–ª—è –º–æ–¥–µ–ª–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GPU
def preprocess(image_path):
    input_image = Image.open(image_path)
    preprocess = T.Compose([
        T.ToTensor(),
        T.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]),
    ])
    input_tensor = preprocess(input_image).to(device)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ GPU
    input_batch = input_tensor.unsqueeze(0)  # –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä batch
    return input_batch, input_image

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–∞—Å–∫–∏
def get_segmentation_mask(image_path):
    input_batch, input_image = preprocess(image_path)

    with torch.no_grad():
        output = model(input_batch)['out'][0]
    output_predictions = output.argmax(0).byte().cpu().numpy()  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ CPU –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

    # –°–æ–∑–¥–∞—ë–º –º–∞—Å–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
    masks = {
        'person': output_predictions == 15,  # —á–µ–ª–æ–≤–µ–∫
        'clothing': output_predictions == 17,  # –æ–¥–µ–∂–¥–∞
        'shoes': output_predictions == 18,  # –æ–±—É–≤—å
        'bag': output_predictions == 24,  # —Å—É–º–∫–∞
        'hat': output_predictions == 25,  # —à–ª—è–ø–∞
        # –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã, –µ—Å–ª–∏ –Ω–æ–º–µ—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –∏–∑–≤–µ—Å—Ç–Ω—ã
        # 'socks': output_predictions == <–Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞>,  # –Ω–æ—Å–∫–∏
        # 'underwear': output_predictions == <–Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞>,  # –Ω–∏–∂–Ω–µ–µ –±–µ–ª—å–µ
        # 'pants': output_predictions == <–Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞>,  # —à—Ç–∞–Ω—ã
        # 'shorts': output_predictions == <–Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞>,  # —à–æ—Ä—Ç—ã
        # 'scarf': output_predictions == <–Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞>  # —à–∞—Ä—Ñ
    }

    return masks, input_image

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
image_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Photo'
mask_deeplabv3_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Mask_DeepLabV3'

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –º–∞—Å–æ–∫ DeepLabV3, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if not os.path.exists(mask_deeplabv3_dir):
    os.makedirs(mask_deeplabv3_dir)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–ø–∫–µ
for image_file in os.listdir(image_dir):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "100001_27.09.2024_22.05.jpg")
    if image_file.endswith('.jpg') and len(image_file.split('_')) == 3:
        image_path = os.path.join(image_dir, image_file)

        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        masks, input_image = get_segmentation_mask(image_path)

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–∞—Å–æ–∫
        input_image = np.array(input_image)

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π –∫–ª–∞—Å—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–ª–æ—â–∞–¥–∏ –º–∞—Å–∫–∏
        dominant_class = None
        max_area = 0

        for mask_name, mask in masks.items():
            area = mask.sum()  # –ü–ª–æ—â–∞–¥—å –º–∞—Å–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏–∫—Å–µ–ª–µ–π)
            if area > max_area:
                max_area = area
                dominant_class = mask_name

        # –ï—Å–ª–∏ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π –∫–ª–∞—Å—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, —Å–æ–∑–¥–∞–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∞—Å–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞
        if dominant_class:
            dominant_mask = masks[dominant_class].astype(np.uint8) * 255
            combined_image = Image.fromarray(dominant_mask)

            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Å–∫–∏
            combined_filename = f'{os.path.splitext(image_file)[0]}_combined_deeplabv3.png'

            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∞—Å–∫—É –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            save_path = os.path.join(mask_deeplabv3_dir, combined_filename)
            combined_image.save(save_path)
            print(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞ {dominant_class} –¥–ª—è {image_file}: {save_path}")

print("–ú–∞—Å–∫–∏ DeepLabV3 —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.")
```
## –®–ê–ì 4.2 –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ deeplabv3_resnet101

```python
import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader, Dataset
import torchvision.transforms as T
from PIL import Image
import os

# –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
should_train_model = True  # –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ False, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ

# –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
model_save_path = '/BackFreeBot_CV/deeplabv3_resnet101.pth'

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
def load_model(model_path, device):
    model = torch.hub.load('pytorch/vision:v0.10.0', 'deeplabv3_resnet101', pretrained=False)
    state_dict = torch.load(model_path, map_location=device)
    model.load_state_dict(state_dict, strict=False)  # strict=False, —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Å–ª–æ–∏
    model.to(device)
    return model

# –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
class CustomSegmentationDataset(Dataset):
    def __init__(self, image_dir, mask_dir, transform=None):
        self.image_dir = image_dir
        self.mask_dir = mask_dir
        self.transform = transform
        self.images = [file for file in os.listdir(image_dir) if file.endswith('.jpg')]

    def __len__(self):
        return len(self.images)

    def __getitem__(self, idx):
        image_path = os.path.join(self.image_dir, self.images[idx])
        mask_path = os.path.join(self.mask_dir, os.path.splitext(self.images[idx])[0] + '_mask.png')

        image = Image.open(image_path).convert("RGB")
        mask = Image.open(mask_path).convert("L")  # –ú–∞—Å–∫–∞ –≤ –≥—Ä–∞–¥–∞—Ü–∏—è—Ö —Å–µ—Ä–æ–≥–æ

        if self.transform:
            image = self.transform(image)
            mask = T.ToTensor()(mask).long()  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å–∫—É –≤ —Ç–µ–Ω–∑–æ—Ä

        return image, mask

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–∞—Å–æ–∫
transform = T.Compose([
    T.ToTensor(),
    T.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
])

# –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –∏ –º–∞—Å–∫–∞–º
image_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Photo'
mask_dir = '/BackFreeBot_CV/BackFreeBot_folderId_Mask_DeepLabV3'

if should_train_model:
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    dataset = CustomSegmentationDataset(image_dir=image_dir, mask_dir=mask_dir, transform=transform)
    data_loader = DataLoader(dataset, batch_size=4, shuffle=True, num_workers=2)

    # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (GPU –∏–ª–∏ CPU)
    device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
    model = load_model(model_save_path, device)

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
    criterion = nn.CrossEntropyLoss()  # –§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å –¥–ª—è –º–Ω–æ–≥–æ–∫–ª–∞—Å—Å–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
    optimizer = optim.Adam(model.parameters(), lr=1e-4)

    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è
    num_epochs = 10

    # –¶–∏–∫–ª –¥–æ–æ–±—É—á–µ–Ω–∏—è
    for epoch in range(num_epochs):
        model.train()
        running_loss = 0.0

        for images, masks in data_loader:
            images, masks = images.to(device), masks.to(device)

            optimizer.zero_grad()

            outputs = model(images)['out']
            loss = criterion(outputs, masks.squeeze(1))  # –°–∂–∏–º–∞–µ–º —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –º–∞—Å–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å

            loss.backward()
            optimizer.step()

            running_loss += loss.item()

        print(f"–≠–ø–æ—Ö–∞ [{epoch + 1}/{num_epochs}], –ü–æ—Ç–µ—Ä–∏: {running_loss / len(data_loader)}")

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
    torch.save(model.state_dict(), model_save_path)
    print(f"–î–æ–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ {model_save_path}")
else:
    print("–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–æ–ø—É—â–µ–Ω–æ.")
```
